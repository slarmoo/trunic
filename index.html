<!DOCTYPE html5>
<head>
    <link rel="stylesheet" href="./main.css" />
</head>
<body>
    <div id="runes">

    </div>
    <div id="paragraphs">
        
    </div>
</body>

<script>
    const runeCount = 0x34;
    const runeLinks = [];
    const runeTranslations = JSON.parse(localStorage.getItem("translation")) || [];
    const inputTranslations = [];
    const occurrances = [];
    // runeTranslations[0x33] = "z";
    
    for(let i = 0x0; i <= runeCount; i++) {
        runeLinks.push("./trunes/runes/" + decimalToHex(i) + ".png");
    }

    for(const rune in runeLinks) {
        const runeHolder = document.getElementById("runes"); 
        const img = document.createElement("img");
        img.width = 100;
        img.src = runeLinks[rune];
        img.classList = "image";
        const runeBorder = document.createElement("div");
        runeBorder.classList = "holder";
        runeBorder.appendChild(img);
        runeHolder.appendChild(runeBorder);
        const input = document.createElement("input");
        input.type = "text";
        input.classList = "inputTest";
        input.id = rune;
        input.value = runeTranslations[rune];
        const info = document.createElement("div");
        info.classList = "info";
        info.appendChild(input);
        runeBorder.appendChild(info);
        inputTranslations[rune] = input;
        input.addEventListener("input", (event) => {
            const input = event.target;
            runeTranslations[input.id] = input.value;
            localStorage.setItem("translation", JSON.stringify(runeTranslations));
        })
        img.title = decimalToHex(rune);
        const occurrance = document.createElement("span");
        occurrances[rune] = occurrance;
        info.append(occurrance);
    }

    const trunicText = [
        0x17, " ", 0x04, 0x08, 0x16, " ", 0x01, " ", "Civilization", " ", 0x2f, " ", 0x05, 0x2a, 0x03, " ", 0x2d, 0x02, ".\n",
        0x07, " ", 0x09, 0x06, 0x03, " ", 0x01, " ", 0x2c, 0x23, ", ", 0x0b, 0x16, " ", 0x28, 0x22, 0x0c, " ", 0x15, 0x03, " ", 0x2c, 0x23, " ", 0x07, " ", 0x09, 0x06, 0x03, "\n",
        0x01, " ", 0x0e, 0x04, 0x2e, ". ", 0x07, " ", 0x13, 0x06, 0x16, " ", 0x0d, 0x14, 0x24, 0x16, " ", 0x0a, " ", 0x21, 0x14, 0x24, 0x03, 0x2e, " ", 0x2f, "\n",
        0x0a, " ", "Holy Cross", ", ", 0x0b, 0x16, " ", 0x29, 0x1e, " ", 0x2e, 0x12, 0x16, " ", 0x0a, " ", 0x30, 0x11, 0x27, "\n",
        0x10, 0x20, " ", 0x2f, 0x1d, 0x1f, 0x25, 0x1a, ". ", 0x07, " ", 0x19, 0x0c, 0x20, 0x16, " ", 0x2b, " ", 0x0a, " ", 0x0f, " ", 0x26, "\n",
        0x0b, 0x16, " ", 0x1b, 0x03, " ", 0x2d, 0x02, " ", 0x1c, 0x31, 0x00, " ", 0x0a, " ", 0x2e, 0x32, 0x2c, 0x33, " ", 0x34, 0x03, 0x18, 0x0c, ". "
    ];

    const ocmap = {};
    const text = document.createElement("p");
    text.classList = "paragraph";

    for(let i = 0; i < trunicText.length; i++) {
        ocmap[trunicText[i]] = ocmap[trunicText[i]] || 0; 
        ocmap[trunicText[i]]++;

        if(typeof trunicText[i] == "number" ) {
            if(!runeTranslations[trunicText[i]]) {
                const img = document.createElement("img");
                img.width = 15;
                img.src = runeLinks[trunicText[i]];
                img.classList = "image";
                const span = document.createElement("span");
                span.appendChild(img);
                // text.innerHTML += span;
                text.appendChild(span);
                span.classList = "span";
            } else {
                text.innerHTML += runeTranslations[trunicText[i]];
            }
        } else {
            if(trunicText[i].includes("\n")) {
                text.appendChild(document.createElement("br"));
            } else {
                text.innerHTML += trunicText[i];
                if (trunicText[i] + "".includes(" ")) {
                    text.innerHTML += "     ";
                }
            }
        }

    }

    document.getElementById("paragraphs").appendChild(text);

    for(let i = 0; i < occurrances.length; i++) {
        occurrances[i].innerText = ocmap[i] + " times,\n" + (Math.round(ocmap[i] / trunicText.length * 10000)/100) + "%";
    }

    function decimalToHex(decimal) {
        const original = decimal;
        let hex = "";
        const hexVals = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"];
        while (decimal > 0) {
            hex = hexVals[decimal % 16] + hex;
            decimal = Math.floor(decimal /16);
        }
        return "0x" + (hex.length < 2 ? "0" : "") + (hex.length < 1 ? "0" : "") + hex;
    }
</script>